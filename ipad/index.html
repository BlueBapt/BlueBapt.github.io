<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pour mon ipad mini</title>
</head>
<body>
    <div class="b">
        <button id="save">Sauvegarder</button>
        <label for="files">Fichier :</label>
        <select name="files" id="files">
        </select>
        <button id="load">Charger</button>
    </div>
    <hr>
    <textarea id="content">Ecrire ici</textarea>
</body>

<style>
.b{
    margin: 0.5em;
}
#download{
    font-size:x-large;
}
textarea{
    width: 100%;
    height: 100vh;
    padding: 0;
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 1.1em;
    border: none;
    border-top-style:groove;
}

body{
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 0;
    margin:0;
}
</style>

<script>

    const sto = localStorage;

    let file_names = sto.getItem("notes")
    if(file_names==null){
        sto.setItem("notes",JSON.stringify([]))
    }else{
        file_names=JSON.parse(file_names)
    }


    if(file_names != null){
        let select = document.getElementById("files")
        for(let i=0;i<file_names.length;i++){
            let option = document.createElement("option")
            option.setAttribute("value",file_names[i])
            option.innerText=file_names[i]
            select.appendChild(option)
        }
    }

    function save(){
        var name = prompt("Quel nom?");
        if(name==null){
            name="export";
        }
        if(!file_names.includes(name)){
            file_names.push(name)
            sto.setItem("notes",JSON.stringify(file_names))
            let select = document.getElementById("files")
            select.innerHTML=""
            for(let i=0;i<file_names.length;i++){
                let option = document.createElement("option")
                option.setAttribute("value",file_names[i])
                option.innerText=file_names[i]
                select.appendChild(option)
            }
        }
        sto.setItem("file-"+name,document.getElementById("content").value.trim())
    }

    function getSelectedText(elementId) {
        var elt = document.getElementById(elementId);
    
        if (elt.selectedIndex == -1)
            return null;
    
        return elt.options[elt.selectedIndex].text;
    }
      
    document.getElementById("save")
          .addEventListener("click", function () {
                save()
          }, false);

    document.getElementById("load")
          .addEventListener("click", function () {
                let text = getSelectedText('files')
                document.getElementById("content").value=sto.getItem("file-"+text)
          }, false);
</script>


</html>